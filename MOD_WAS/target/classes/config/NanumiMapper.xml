<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nanumiNS">
    <!-- SignUp -->
    <insert id="signUp" parameterType="User">
	    insert into member(userid,pwd,nickname,address,email)
		values(#{userid}, #{pwd}, #{nickname}, #{address}, #{email})
	</insert>
	
    <select id="checkUserId" parameterType="String" resultType="User">
		select userid
		  from member
		 where userid = #{userid}
	</select>
	
	<select id="checkUserNickname" parameterType="String" resultType="User">
		select nickname
		  from member
		 where nickname = #{nickname}
	</select>
	
	<select id="checkUserEmail" parameterType="String" resultType="User">
		select email
		  from member
		 where email = #{email}
	</select>
	
	<!-- Login -->
	<select id="login" parameterType="String" resultType="User">
		select userid, pwd
		  from member
		 where userid = #{userid}
	</select>
	
	<!-- Search Address -->
	<select id="cityList" resultType="City">
		select *
		  from city
		 order by citycode
	</select>

	<select id="districtList" resultType="District">
		select *
		  from district
		 order by citycode
	</select>
	
	<select id="getUserIdByEmail" parameterType="String" resultType="String">
	    select userid
	      from member
	     where email = #{email}
	</select>
	
	<update id="modifyUserInfo" parameterType="User">
	    update member
	       set pwd = #{pwd},
	           nickname = #{nickname},
	           address = #{address},
	           email = #{email}
	     where userid = #{userid}
	</update>
	
	<insert id="writingGoods">
	    insert into GOODS(articleNum, userid, city, district, major, sub,
	                      contents, hashtag, selectionWay, postingTime)
		values(SEQ_1.nextval, #{userid}, #{city}, #{district}, #{major}, #{sub},
		       #{contents}, #{hashtag}, #{selectionWay}, sysdate)
	</insert>
	
	<insert id="insertFile" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
    <selectKey keyProperty="IDX" resultType="string" order="BEFORE">
        SELECT SEQ_TB_BOARD_IDX.NEXTVAL FROM DUAL
    </selectKey>
    <![CDATA[
        INSERT INTO TB_FILE(IDX, BOARD_IDX, ORIGINAL_FILE_NAME, STORED_FILE_NAME,
                            FILE_SIZE, CREA_ID)
        VALUES(SEQ_TB_FILE_IDX.NEXTVAL, #{BOARD_IDX}, #{ORIGINAL_FILE_NAME},
               #{STORED_FILE_NAME}, #{FILE_SIZE}, 'Admin')
    ]]>
	</insert>
</mapper>